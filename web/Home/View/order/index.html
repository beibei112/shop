<extend name="layout:home-index" />

<block name="con">
<script type="text/javascript" src="__PUBLIC__/sel/jquery.js"></script>
<script type="text/javascript" src="__PUBLIC__/sel/area.js"></script>
<script type="text/javascript" src="__PUBLIC__/sel/location.js"></script>
<script type="text/javascript" src="__PUBLIC__/sel/jquery.min.js"></script>

	<style type="text/css">
		.sel{
			background-color: #eee;
		}
	</style>
	<div class="container">
		
		<hr class="tail">

		<div class="row">
			<div class="col-md-12">
				<h2 class="shorter"><strong>Checkout</strong></h2>
				<p>Returning customer? <a href="shop-login.html">Click here to login.</a></p>
			</div>
		</div>

		<div class="row">
			<div class="col-md-9">
				<div class="panel-group" id="accordion">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h4 class="panel-title">
								<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
									Select Address
								</a>
							</h4>
						</div>
						<div id="collapseOne" class="accordion-body collapse in" aria-expanded="true" style="">
							<div class="panel-body">
							<div class='row'>
							<foreach name='address_list' item='vo'>
								<div class="col-xs-6 col-md-3 add" address='{$vo['id']}' >
										<address>
											<strong>地址:</strong><br />
											<span info='{$vo['sheng']},{$vo['shi']},{$vo['xian']}'></span><br>
											{$vo['jiedao']}<br>
											<strong title="">电话:{$vo['to_phone']}</strong>
										</address>

										<address>
											<strong>To Name</strong><br />
											<a href="mailto:#">{$vo['to_name']}</a>
										</address>
								</div>
							</foreach>
								
							</div>

						</div>
					</div>
				</div>
					<div class="panel panel-default">
						<div class="panel-heading">
							<h4 class="panel-title">
								<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false">
									New Address
								</a>
							</h4>
						</div>
						<div id="collapseTwo" class="accordion-body collapse" aria-expanded="false">
							<div class="panel-body">
								<form action="__MODULE__/address/insert" id="" method="post">
									<div class="row">
										<div class="form-group">
											<div class="col-md-12">
												<label>To_Name:</label>
												<input type="text" name="to_name" value="" class="form-control">
											</div>
										</div>
									</div>
									<div class="row">
										<div class="form-group">
											<div class="col-md-12">
												<label>To_Phone:</label>
												<input type="text" name="to_phone" value="" class="form-control">
											</div>
										</div>
									</div>
									<div class="row">
										<div class="form-group">
											<div class="col-md-12">
												<label>Select City:</label><br>
												<select id="loc_province" class="form-control" name="sheng"></select>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="form-group">
											<div class="col-md-12">
												<label>Select Shi:</label><br>
												<select id="loc_city" class="form-control" name="shi" ></select>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="form-group">
											<div class="col-md-12">
												<label>Select Xian:</label><br>
												<select id="loc_town" class="form-control" name="xian" ></select>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="form-group">
											<div class="col-md-12">
												<label>Jie Dao</label>
												<textarea class='form-control' name="jiedao"></textarea>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-md-12">
											<input type="submit" value="Continue" class="btn btn-primary pull-right push-bottom" data-loading-text="Loading...">
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
					<div class="panel panel-default">
						<div class="panel-heading">
							<h4 class="panel-title">
								<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false">
									Review &amp; Payment
								</a>
							</h4>
						</div>
						<div id="collapseThree" class="accordion-body collapse" aria-expanded="false">
							<div class="panel-body">
								<table cellspacing="0" class="shop_table cart">
									<thead>
										<tr>
											<th class="product-thumbnail">
												&nbsp;
											</th>
											<th class="product-name">
												Product
											</th>
											<th class="product-price">
												Price
											</th>
											<th class="product-quantity">
												Num
											</th>
											<th class="product-subtotal">
												Total
											</th>
										</tr>
									</thead>
									<tbody>
										<foreach name='list' item='vv'>
										<tr class="cart_table_item a">
											<td class="product-thumbnail">
												<a href="">
													<img width="100" height="100" alt="" class="img-responsive" src="{$vv['path']}">
												</a>
											</td>
											<td class="product-name">
												<a href="">{$vv['name']}</a>
											</td>
											<td class="product-price">
												$<span class="amount d">{$vv['price']}</span>
											</td>
											<td class="product-quantity">
												<span class="j">{$vv['num']}</span>件
											</td>
											<td class="product-subtotal">
												<span class="amount z">$299</span>
											</td>
										</tr>
										</foreach>
									</tbody>
								</table>

								<hr class="tall">

								<h4>Cart Totals</h4>
								<table cellspacing="0" class="cart-totals">
									<tbody>
										<tr class="total b">
											<th>
												<strong>Order Total</strong>
											</th>
											<td>
												<strong><span class="amount">$431</span></strong>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>

				<div class="actions-continue">
					<form action="__URL__/order" method="post">
						<input type="hidden" name="address_id" value="">
						<input type="submit" value="Place Order" class="btn btn-lg btn-primary push-top">
					</form>
				</div>
			</div>
			<div class="col-md-3">
				<h4>Cart Totals</h4>
				<table cellspacing="0" class="cart-totals">
					<tbody>
						<tr class="total b">
							<th>
								<strong>Order Total</strong>
							</th>
							<td>
								<strong><span class="amount">$431</span></strong>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
</block>
<block name='js'>
	<script type="text/javascript">

		$(document).ready(function(){
			showLocation();

			//将对应的地址id转换为地址
			//1.获取json数据
			var data = new Location();
			var data1 = data.items;

			//2.获取对应的地址中的数字
			$('.add').each(function(){
				var str = $(this).find('span').attr('info');
				var arr = str.split(',');
				//省
				var sheng = data1[0][arr[0]];
				//市
				var shi = data1['0,'+arr[0]][arr[1]];
				//县
				var xian = data1['0,'+arr[0]+','+arr[1]][arr[2]];

				var str1 = sheng+' '+shi+' '+xian;

				//3.将处理好的字符串写入到标签中
				$(this).find('span').html(str1);
			});

			//3.给地址div添加选中事件
			$('.add').click(function(){
				$(this).siblings().removeClass('sel');
				$(this).addClass('sel');
				
				//修改form中的address_id的值
				$("input[name='address_id']").val($(this).attr('address'));

			});
		});

		function count(){
			var count = 0;
			$('.a').each(function(){
				var price = $(this).find('td:eq(2)').find('span').html();
				var num = parseInt($(this).find('td:eq(3)').find('span').html());

				// 写入小计
				$(this).find('td:eq(4)').find('span').html('$'+price*num);

				count+=price*num;
			});
			$('.b').find('td:eq(0)').find('strong').find('span').html('$'+count);
		}
		count();
	</script>	
</block>